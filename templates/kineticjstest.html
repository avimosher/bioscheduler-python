<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <title>Bioscheduler</title>
  {% load staticfiles %}
  <link rel="stylesheet" type="text/css" href="{% static "datatables/css/jquery.dataTables.css" %}">
  <link rel="stylesheet" href="{% static "jquery-ui/jquery-ui.css" %}">
  <script src="{% static "tmcalc-support.js" %}"></script>
  <script src="{% static "kinetic.js" %}"></script>
  <script src="{% static "kineticsequence.js" %}"></script>
  <script src="{% static "jquery.min.js" %}"></script>
  <script src="{% static "datatables/js/jquery.dataTables.js" %}"></script>
  <script src="{% static "jquery-ui/jquery-ui.js" %}"></script>
  <link rel="stylesheet" href="{% static "evidencegraph.css" %}">
  <script src="{% static "d3.v3.min.js" %}"></script>
  <script src="{% static "evidencegraph.js" %}"></script>
  <script src="{% static "contextMenu/jquery.ui.position.js" %}"></script>
  <script src="{% static "contextMenu/jquery.contextMenu.js" %}"></script>
  <link rel="stylesheet" type="text/css" href="{% static "contextMenu/jquery.contextMenu.css" %}"/>
  <style>
  body {margin: 0px;}
  .ui-widget-content { width: 150px; height: 150px; position: absolute; }
  #container {
    border: 1px solid black;
    height: 400px;
    width: 400px;
    overflow-y: auto;
    overflow-x: hidden;
    padding: 1em;
  }
  .tab_container {
    width: 100%;
    height: 100%;
    position: relative;
  }
  .contain_canvas {
      width: 95%;
      height: 95%;
      position: relative;
  }
  #outer
  {
    background-color: #FF0808;
  }
  #leftDiv
  {
    position: relative;
    float: left;
    width: 30vw;
    height: 90vh;
    background-color: #FFD8D8;
  }
  #rightDiv
  {
    position: relative;
    float: left;
    width: 70vw;
    height: 90vh;
    background-color: #D8D8FF;
    overflow: auto;
    overflow-x: hidden;
  }
  </style>
  <script id="main" class="init">
  $(document).ready(function() {
    function getCookie(name) {
        var cookieValue = null;
        if (document.cookie && document.cookie != '') {
            var cookies = document.cookie.split(';');
            for (var i = 0; i < cookies.length; i++) {
                var cookie = jQuery.trim(cookies[i]);
                // Does this cookie string begin with the name we want?
                if (cookie.substring(0, name.length + 1) == (name + '=')) {
                    cookieValue = decodeURIComponent(cookie.substring(name.length + 1));
                    break;
                }
            }
        }
        return cookieValue;
    }
    var csrftoken = getCookie('csrftoken');

    function loadsequence(sequencePath){
      $.ajax({
        url: 'getsequence',
        type: 'POST',
        datatype: 'json',
        data: {
          name: sequencePath,
          csrfmiddlewaretoken: '{{ csrf_token }}'
        },
        beforeSend: function(xhr) {
          xhr.setRequestHeader("Accept", "application/json");
          xhr.setRequestHeader("X-CSRFToken", csrftoken);
        },
        success: function(seq) {
          sequenceeditor(seq);
        },
        error: function(XMLHttpRequest,textStatus,errorThrown) {
          alert("Status: " + textStatus); alert("Error: " + errorThrown);
        }
      });
    }

    $.ajax({
      url: "getlist",
      type: "POST",
      headers: {
        'Accept': 'application/json',
        'Content-Type': 'application/json'
      },          
      beforeSend: function(xhr) {
        xhr.setRequestHeader("Accept", "application/json");
        xhr.setRequestHeader("Content-Type", "application/json");
        xhr.setRequestHeader("X-CSRFToken", csrftoken);
      },
      
      success: function(seqList) {
        $('#demo').html( '<table cellpadding="0" cellspacing="0" border="0" class="display" id="example"></table>' );
        $('#example').dataTable( {
          "data" : seqList,
          "columns": [
          { "title": "Name"},
          { "title": "Length", "class": "center"},
          { "title": "Sequence"}],
          "columnDefs": [
          { "targets": [2], "visible": false}
          ]
        });
        $('#example tbody').on('dblclick', 'tr', function() {
          var name=$('td',this).eq(0).text(); // this is how the datatables demo does it, sadly
          loadsequence(name);
        });
        $('#example > tbody > tr').draggable({
          //containment: "#outer",
          helper: function(event) {
            var _this=$(this);
            var name=$('td',this).eq(0).text();
            var new_ele=$('<li></li>')
              .append('<span>'+name+'</span>');
            return new_ele.clone();
          },
          appendTo: 'body'
        });
      }
    });

    $('#dropboxform').submit(function(e) {
      var formURL=$(this).attr("action");
      $.ajax({
        url: formURL,
        type: "POST",
        data: {key: $('#dropboxkey').val()},
        traditional: true,
        dataType: 'html',
        beforeSend: function(xhr) {
          xhr.setRequestHeader("X-CSRFToken", csrftoken);
        },
        success: function() {
        }      
      });
      e.preventDefault();
    });

    $('#accordion').accordion({
      heightStyle: "fill",
      collapsible: true
    });


    $.contextMenu({
      selector: ".contain_canvas",
      callback: function(key, options) {
        var m="clicked: "+key;
        options.$trigger.trigger("mapoligos");
      },
      items: {
        "edit": {name: "Edit", icon: "edit"},
        "cut": {name: "Cut", icon: "cut"},
        "copy": {name: "Copy", icon: "copy"},
        "paste": {name: "Paste", icon: "paste"},
        "delete": {name: "Delete", icon: "delete"},
        "sep1": "---------",
        "quit": {name: "Quit", icon: "quit"}
      }
    });
  });


</script>
</head>
<body>
 
<div id="outer">
  <div id="header" style="background-color:#FFA500;">
    <h1 style="margin-bottom:0;">Bioscheduler <img id="testMenu" src="{% static "icons/graph_32x32.png" %}" onclick="evidenceGraph();" /></h1>
  </div>

  <div id="leftDiv">
    <div id="demo"></div>
  </div>

  <div id="rightDiv">
    <div id="accordion">
    </div>
  </div>
</div>
 
</body>
</html>
