var locationsModule=(function() {
	var module={};

	module.locations=function() {
		var $accordion=$("#accordion");
		var $header=$('<h3/>',{text: "Babylon"});
		var $div=$('<div/>',{class: 'tab_container locations', id: "babylon_container"});
		var babylonContainerName="babylon";
		//var containCanvas=$('<canvas/>',{id: babylonContainerName});
		//containCanvas.appendTo($div);
		$accordion.append([$header,$div]);
		$accordion.accordion('refresh');
		$accordion.accordion("option","active",-1);

		var sceneJson={
			"metadata": {
				"version": 4.3,
				"type": "Object",
				"generator": "ObjectExporter"
			},
			"geometries": [
				{
					"uuid": "5efcf1c1-e52b-4e28-afcd-a0f2e57a57a8",
					"type": "Geometry",
					"data": {
						"vertices": [
							0.5,
							0.5,
							0.5,
							0.5,
							0.5,
							-0.5,
							0.5,
							-0.5,
							0.5,
							0.5,
							-0.5,
							-0.5,
							-0.5,
							0.5,
							-0.5,
							-0.5,
							0.5,
							0.5,
							-0.5,
							-0.5,
							-0.5,
							-0.5,
							-0.5,
							0.5
						],
						"normals": [
							1,
							0,
							0,
							-1,
							0,
							0,
							0,
							1,
							0,
							0,
							-1,
							0,
							0,
							0,
							1,
							0,
							0,
							-1
						],
						"uvs": [
							[
								0,
								1,
								0,
								0,
								1,
								0,
								1,
								1
							]
						],
						"faces": [
							56,
							0,
							2,
							3,
							0,
							1,
							2,
							0,
							0,
							0,
							0,
							56,
							0,
							3,
							1,
							0,
							2,
							3,
							0,
							0,
							0,
							0,
							56,
							4,
							6,
							7,
							0,
							1,
							2,
							1,
							1,
							1,
							1,
							56,
							4,
							7,
							5,
							0,
							2,
							3,
							1,
							1,
							1,
							1,
							56,
							4,
							5,
							0,
							0,
							1,
							2,
							2,
							2,
							2,
							2,
							56,
							4,
							0,
							1,
							0,
							2,
							3,
							2,
							2,
							2,
							2,
							56,
							7,
							6,
							3,
							0,
							1,
							2,
							3,
							3,
							3,
							3,
							56,
							7,
							3,
							2,
							0,
							2,
							3,
							3,
							3,
							3,
							3,
							56,
							5,
							7,
							2,
							0,
							1,
							2,
							4,
							4,
							4,
							4,
							56,
							5,
							2,
							0,
							0,
							2,
							3,
							4,
							4,
							4,
							4,
							56,
							1,
							3,
							6,
							0,
							1,
							2,
							5,
							5,
							5,
							5,
							56,
							1,
							6,
							4,
							0,
							2,
							3,
							5,
							5,
							5,
							5
						]
					}
				},
				{
					"uuid": "54d22761-6fa5-469d-9dc3-ec0d8b68343f",
					"type": "Geometry",
					"data": {
						"vertices": [
							0.5,
							0.5,
							0.5,
							0.5,
							0.5,
							-0.5,
							0.5,
							-0.5,
							0.5,
							0.5,
							-0.5,
							-0.5,
							-0.5,
							0.5,
							-0.5,
							-0.5,
							0.5,
							0.5,
							-0.5,
							-0.5,
							-0.5,
							-0.5,
							-0.5,
							0.5
						],
						"normals": [
							1,
							0,
							0,
							-1,
							0,
							0,
							0,
							1,
							0,
							0,
							-1,
							0,
							0,
							0,
							1,
							0,
							0,
							-1
						],
						"uvs": [
							[
								0,
								1,
								0,
								0,
								1,
								0,
								1,
								1
							]
						],
						"faces": [
							56,
							0,
							2,
							3,
							0,
							1,
							2,
							0,
							0,
							0,
							0,
							56,
							0,
							3,
							1,
							0,
							2,
							3,
							0,
							0,
							0,
							0,
							56,
							4,
							6,
							7,
							0,
							1,
							2,
							1,
							1,
							1,
							1,
							56,
							4,
							7,
							5,
							0,
							2,
							3,
							1,
							1,
							1,
							1,
							56,
							4,
							5,
							0,
							0,
							1,
							2,
							2,
							2,
							2,
							2,
							56,
							4,
							0,
							1,
							0,
							2,
							3,
							2,
							2,
							2,
							2,
							56,
							7,
							6,
							3,
							0,
							1,
							2,
							3,
							3,
							3,
							3,
							56,
							7,
							3,
							2,
							0,
							2,
							3,
							3,
							3,
							3,
							3,
							56,
							5,
							7,
							2,
							0,
							1,
							2,
							4,
							4,
							4,
							4,
							56,
							5,
							2,
							0,
							0,
							2,
							3,
							4,
							4,
							4,
							4,
							56,
							1,
							3,
							6,
							0,
							1,
							2,
							5,
							5,
							5,
							5,
							56,
							1,
							6,
							4,
							0,
							2,
							3,
							5,
							5,
							5,
							5
						]
					}
				},
				{
					"uuid": "b7071a1c-e943-45f4-8107-3db77ecc0e1e",
					"type": "Geometry",
					"data": {
						"vertices": [
							0.5,
							0.5,
							0.5,
							0.5,
							0.5,
							-0.5,
							0.5,
							-0.5,
							0.5,
							0.5,
							-0.5,
							-0.5,
							-0.5,
							0.5,
							-0.5,
							-0.5,
							0.5,
							0.5,
							-0.5,
							-0.5,
							-0.5,
							-0.5,
							-0.5,
							0.5
						],
						"normals": [
							1,
							0,
							0,
							-1,
							0,
							0,
							0,
							1,
							0,
							0,
							-1,
							0,
							0,
							0,
							1,
							0,
							0,
							-1
						],
						"uvs": [
							[
								0,
								1,
								0,
								0,
								1,
								0,
								1,
								1
							]
						],
						"faces": [
							56,
							0,
							2,
							3,
							0,
							1,
							2,
							0,
							0,
							0,
							0,
							56,
							0,
							3,
							1,
							0,
							2,
							3,
							0,
							0,
							0,
							0,
							56,
							4,
							6,
							7,
							0,
							1,
							2,
							1,
							1,
							1,
							1,
							56,
							4,
							7,
							5,
							0,
							2,
							3,
							1,
							1,
							1,
							1,
							56,
							4,
							5,
							0,
							0,
							1,
							2,
							2,
							2,
							2,
							2,
							56,
							4,
							0,
							1,
							0,
							2,
							3,
							2,
							2,
							2,
							2,
							56,
							7,
							6,
							3,
							0,
							1,
							2,
							3,
							3,
							3,
							3,
							56,
							7,
							3,
							2,
							0,
							2,
							3,
							3,
							3,
							3,
							3,
							56,
							5,
							7,
							2,
							0,
							1,
							2,
							4,
							4,
							4,
							4,
							56,
							5,
							2,
							0,
							0,
							2,
							3,
							4,
							4,
							4,
							4,
							56,
							1,
							3,
							6,
							0,
							1,
							2,
							5,
							5,
							5,
							5,
							56,
							1,
							6,
							4,
							0,
							2,
							3,
							5,
							5,
							5,
							5
						]
					}
				},
				{
					"uuid": "7aba24c3-51cc-417d-8786-a79f7ea92483",
					"type": "Geometry",
					"data": {
						"vertices": [
							0.5,
							0.5,
							0.5,
							0.5,
							0.5,
							-0.5,
							0.5,
							-0.5,
							0.5,
							0.5,
							-0.5,
							-0.5,
							-0.5,
							0.5,
							-0.5,
							-0.5,
							0.5,
							0.5,
							-0.5,
							-0.5,
							-0.5,
							-0.5,
							-0.5,
							0.5
						],
						"normals": [
							1,
							0,
							0,
							-1,
							0,
							0,
							0,
							1,
							0,
							0,
							-1,
							0,
							0,
							0,
							1,
							0,
							0,
							-1
						],
						"uvs": [
							[
								0,
								1,
								0,
								0,
								1,
								0,
								1,
								1
							]
						],
						"faces": [
							56,
							0,
							2,
							3,
							0,
							1,
							2,
							0,
							0,
							0,
							0,
							56,
							0,
							3,
							1,
							0,
							2,
							3,
							0,
							0,
							0,
							0,
							56,
							4,
							6,
							7,
							0,
							1,
							2,
							1,
							1,
							1,
							1,
							56,
							4,
							7,
							5,
							0,
							2,
							3,
							1,
							1,
							1,
							1,
							56,
							4,
							5,
							0,
							0,
							1,
							2,
							2,
							2,
							2,
							2,
							56,
							4,
							0,
							1,
							0,
							2,
							3,
							2,
							2,
							2,
							2,
							56,
							7,
							6,
							3,
							0,
							1,
							2,
							3,
							3,
							3,
							3,
							56,
							7,
							3,
							2,
							0,
							2,
							3,
							3,
							3,
							3,
							3,
							56,
							5,
							7,
							2,
							0,
							1,
							2,
							4,
							4,
							4,
							4,
							56,
							5,
							2,
							0,
							0,
							2,
							3,
							4,
							4,
							4,
							4,
							56,
							1,
							3,
							6,
							0,
							1,
							2,
							5,
							5,
							5,
							5,
							56,
							1,
							6,
							4,
							0,
							2,
							3,
							5,
							5,
							5,
							5
						]
					}
				},
				{
					"uuid": "e825e9ee-ff00-4ceb-bdaa-afa32f867c6f",
					"type": "Geometry",
					"data": {
						"vertices": [
							0.5,
							0.5,
							0.5,
							0.5,
							0.5,
							-0.5,
							0.5,
							-0.5,
							0.5,
							0.5,
							-0.5,
							-0.5,
							-0.5,
							0.5,
							-0.5,
							-0.5,
							0.5,
							0.5,
							-0.5,
							-0.5,
							-0.5,
							-0.5,
							-0.5,
							0.5
						],
						"normals": [
							1,
							0,
							0,
							-1,
							0,
							0,
							0,
							1,
							0,
							0,
							-1,
							0,
							0,
							0,
							1,
							0,
							0,
							-1
						],
						"uvs": [
							[
								0,
								1,
								0,
								0,
								1,
								0,
								1,
								1
							]
						],
						"faces": [
							56,
							0,
							2,
							3,
							0,
							1,
							2,
							0,
							0,
							0,
							0,
							56,
							0,
							3,
							1,
							0,
							2,
							3,
							0,
							0,
							0,
							0,
							56,
							4,
							6,
							7,
							0,
							1,
							2,
							1,
							1,
							1,
							1,
							56,
							4,
							7,
							5,
							0,
							2,
							3,
							1,
							1,
							1,
							1,
							56,
							4,
							5,
							0,
							0,
							1,
							2,
							2,
							2,
							2,
							2,
							56,
							4,
							0,
							1,
							0,
							2,
							3,
							2,
							2,
							2,
							2,
							56,
							7,
							6,
							3,
							0,
							1,
							2,
							3,
							3,
							3,
							3,
							56,
							7,
							3,
							2,
							0,
							2,
							3,
							3,
							3,
							3,
							3,
							56,
							5,
							7,
							2,
							0,
							1,
							2,
							4,
							4,
							4,
							4,
							56,
							5,
							2,
							0,
							0,
							2,
							3,
							4,
							4,
							4,
							4,
							56,
							1,
							3,
							6,
							0,
							1,
							2,
							5,
							5,
							5,
							5,
							56,
							1,
							6,
							4,
							0,
							2,
							3,
							5,
							5,
							5,
							5
						]
					}
				}
			],
			"materials": [
				{
					"uuid": "D4133F72-A5FD-40D7-B86C-96771C16B4E6",
					"type": "MeshPhongMaterial",
					"color": 11579568,
					"ambient": 11579568,
					"emissive": 0,
					"specular": 0,
					"shininess": 50,
					"opacity": 1,
					"transparent": false,
					"wireframe": false
				},
				{
					"uuid": "287DFEC6-3123-4427-838A-B03C1DA9395A",
					"type": "MeshPhongMaterial",
					"color": 11579568,
					"ambient": 11579568,
					"emissive": 0,
					"specular": 0,
					"shininess": 50,
					"opacity": 1,
					"transparent": false,
					"wireframe": false
				},
				{
					"uuid": "E460E991-29CE-44B5-BC62-B96D51415D4D",
					"type": "MeshPhongMaterial",
					"color": 11579568,
					"ambient": 11579568,
					"emissive": 0,
					"specular": 0,
					"shininess": 50,
					"opacity": 1,
					"transparent": false,
					"wireframe": false
				},
				{
					"uuid": "5CF73210-8C07-44EC-AFBD-EAB2E6C4FF78",
					"type": "MeshPhongMaterial",
					"color": 11579568,
					"ambient": 11579568,
					"emissive": 0,
					"specular": 0,
					"shininess": 50,
					"opacity": 1,
					"transparent": false,
					"wireframe": false
				},
				{
					"uuid": "51F37CFF-1BA0-4E9B-9FC5-8297003271B2",
					"type": "MeshPhongMaterial",
					"color": 11579568,
					"ambient": 11579568,
					"emissive": 0,
					"specular": 0,
					"shininess": 50,
					"opacity": 1,
					"transparent": false,
					"wireframe": false
				}
			],
			"object": {
				"uuid": "4E365E98-F8DC-4EE1-AD77-7C305F1ED3FE",
				"type": "Scene",
				"matrix": [
					1,
					0,
					0,
					0,
					0,
					1,
					0,
					0,
					0,
					0,
					1,
					0,
					0,
					0,
					0,
					1
				],
				"children": [
					{
						"uuid": "317ffa54-c05c-4b59-843c-b53b49f6a6b6",
						"name": "Box",
						"type": "Mesh",
						"geometry": "5efcf1c1-e52b-4e28-afcd-a0f2e57a57a8",
						"material": "D4133F72-A5FD-40D7-B86C-96771C16B4E6",
						"castShadow": true,
						"receiveShadow": true,
						"matrix": [
							3.66129994392395,
							0,
							0,
							0,
							0,
							1,
							0,
							0,
							0,
							0,
							1,
							0,
							-2.5137999057769775,
							0,
							-0.48249998688697815,
							1
						]
					},
					{
						"uuid": "a1eee245-ecc7-4676-8f7d-0927806d394c",
						"name": "Box1",
						"type": "Mesh",
						"geometry": "54d22761-6fa5-469d-9dc3-ec0d8b68343f",
						"material": "287DFEC6-3123-4427-838A-B03C1DA9395A",
						"castShadow": true,
						"receiveShadow": true,
						"matrix": [
							1,
							0,
							0,
							0,
							0,
							1,
							0,
							0,
							0,
							0,
							1,
							0,
							2.19350004196167,
							0,
							1.906499981880188,
							1
						]
					},
					{
						"uuid": "6be26ba6-c23a-4a21-80a4-38cd39148f6c",
						"name": "Box2",
						"type": "Mesh",
						"geometry": "b7071a1c-e943-45f4-8107-3db77ecc0e1e",
						"material": "E460E991-29CE-44B5-BC62-B96D51415D4D",
						"castShadow": true,
						"receiveShadow": true,
						"matrix": [
							1,
							0,
							0,
							0,
							0,
							1,
							0,
							0,
							0,
							0,
							1,
							0,
							3.2723000049591064,
							0,
							1.9063999652862549,
							1
						]
					},
					{
						"uuid": "6d94d645-1728-40f4-9c57-d299cdb8418f",
						"name": "Box3",
						"type": "Mesh",
						"geometry": "7aba24c3-51cc-417d-8786-a79f7ea92483",
						"material": "5CF73210-8C07-44EC-AFBD-EAB2E6C4FF78",
						"castShadow": true,
						"receiveShadow": true,
						"matrix": [
							1,
							0,
							0,
							0,
							0,
							1,
							0,
							0,
							0,
							0,
							1,
							0,
							0,
							0,
							1.9420000314712524,
							1
						]
					},
					{
						"uuid": "ad657032-9ad0-490f-94c4-f3bbc5da89e1",
						"name": "Box4",
						"type": "Mesh",
						"geometry": "e825e9ee-ff00-4ceb-bdaa-afa32f867c6f",
						"material": "51F37CFF-1BA0-4E9B-9FC5-8297003271B2",
						"castShadow": true,
						"receiveShadow": true,
						"matrix": [
							1,
							0,
							0,
							0,
							0,
							1,
							0,
							0,
							0,
							0,
							1,
							0,
							0,
							0,
							-0.46779999136924744,
							1
						]
					}
				]
			}
		};



		var clock=new THREE.Clock();
		var WIDTH=$div.width();
		var HEIGHT=$div.height();
		//var scene=new THREE.Scene();
		var renderer=new THREE.WebGLRenderer({antialias: true});
		renderer.setSize(WIDTH,HEIGHT);
		renderer.shadowMapEnabled = true;
		renderer.shadowMapSoft = true;
		renderer.shadowMapType = THREE.PCFShadowMap;
		renderer.shadowMapAutoUpdate = true;
		renderer.setClearColorHex(0xffffff, 1);
		$div[0].appendChild(renderer.domElement);
		var VIEW_ANGLE=60;
		var ASPECT=WIDTH/HEIGHT;
		var NEAR=.01;
		var FAR=10;

		//var camera=new THREE.PerspectiveCamera(VIEW_ANGLE,ASPECT,NEAR,FAR);
		var height=10;
		var width=10;
		//var camera=new THREE.OrthographicCamera(width/-2,width/2,height/2,height/-2,1,1000);
		var camera=new THREE.CombinedCamera(width,height,60,NEAR,FAR,1,10);
		var orbit=new THREE.OrbitControls(camera,$div[0]);
		orbit.addEventListener('change',render);
		camera.position.z=0;
		camera.position.x=0;
		camera.position.y=2;
		var target=new THREE.Vector3(0,0,0);
		camera.lookAt(target);
		orbit.target=target;
		camera.updateProjectionMatrix();

		var	loader=new THREE.ObjectLoader();

		var scene=loader.parse(sceneJson);

		var directionalLight = new THREE.DirectionalLight( 0xb8b8b8 );
		directionalLight.position.set(1, 1, 1).normalize();
		directionalLight.intensity = 1.0;
		scene.add( directionalLight );
		
		directionalLight = new THREE.DirectionalLight( 0xb8b8b8 );
		directionalLight.position.set(-1, 0.6, 0.5).normalize();
		directionalLight.intensity = 0.5;
		scene.add(directionalLight);

		directionalLight = new THREE.DirectionalLight();
		directionalLight.position.set(-0.3, 0.6, -0.8).normalize( 0xb8b8b8 );
		directionalLight.intensity = 0.45;
		scene.add(directionalLight);


		function render() {
			requestAnimationFrame(render);
			TWEEN.update();
			camera.lookAt(target);
			camera.updateProjectionMatrix();
			console.log(camera.cameraP.position);
			//console.log(clock.getElapsedTime());
			renderer.render(scene,camera);
		}

		renderer.domElement.addEventListener('mousedown',function(evt) {
			evt.preventDefault();
			var mouse={x: (evt.offsetX/WIDTH)*2-1, y: -(evt.offsetY/HEIGHT)*2+1};
			var vector=new THREE.Vector3(mouse.x,mouse.y,.5);
			console.log(scene);
			vector.unproject(camera);
			var raycaster = new THREE.Raycaster( camera.position, vector.sub( camera.position ).normalize() );
			var intersects = raycaster.intersectObjects( scene.children, true );
			if ( intersects.length > 0 ) {
				//camera.toPerspective();
				//camera.toOrthographic();
				//console.log(intersects[0]);

				var cameraTarget=intersects[0].object.position;
				//cameraTarget=new THREE.Vector3(0,0,-1);
				//cameraTarget.applyMatrix4(camera.matrixWorld);

				var position=new THREE.Vector3().copy(cameraTarget);
				position.x+=5;
				console.log(position);
				new TWEEN.Tween(camera.position).to({
					x: position.x,
					y: position.y,
					z: position.z
				}, 600).easing(TWEEN.Easing.Sinusoidal.InOut).start();
				
				
				new TWEEN.Tween(target).to({
					x: cameraTarget.x,
					y: cameraTarget.y,
					z: cameraTarget.z
				}, 600).easing(TWEEN.Easing.Sinusoidal.InOut).start();
				console.log(cameraTarget);
				new TWEEN.Tween(camera.up).to({
					x: 0, y: 1, z: 0
				},600).easing(TWEEN.Easing.Sinusoidal.InOut).start();
				
				console.log(intersects);
			}

		},false);
		render();
	}

	return module;
}());	